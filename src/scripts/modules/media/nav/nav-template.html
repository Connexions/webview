<script>
var loaded = 0;

function show() {
  var x = document.URL;
  if(loaded == 0){
    document.getElementById("preferences-options").value = localStorage.getItem(x);
    loaded = 1;
  }
  if(document.getElementById("preferences-options").style.display == "none"){
    document.getElementById("preferences-options").style.display ="";
  }
  else{
    document.getElementById("preferences-options").style.display ="none";
   }
}


function contrast_change(a,b,c,d){
  var paragraphs = document.getElementsByTagName("p");
  for(var i = 0; i < paragraphs.length; i++){
    paragraphs[i].style.color = a;
  }
  var headers = document.evaluate(".//div[@class='main-page']//h1", document, null, XPathResult.ANY_TYPE, null); 
  var theHeader = headers.iterateNext();
  while (theHeader){
    theHeader.style.color =a;  
    theHeader = headers.iterateNext();
  }
  var links = document.evaluate(".//div[@class='main-page']//a", document, null, XPathResult.ANY_TYPE, null); 
  var theLink = links.iterateNext();
  while (theLink){
    theLink.style.color =d;  
    theLink = links.iterateNext();
  }

  var captions = document.getElementsByTagName("figure");
  for(var i = 0; i < captions.length; i++){
    captions[i].style.color =a;
  }
  var h2headers = document.getElementsByTagName("h2");
  for(var i = 0; i < h2headers.length; i++){
    h2headers[i].style.color =a;
  }  
  var lists = document.getElementsByTagName("li");
  for(var i = 0; i < lists.length; i++){
    lists[i].style.color =a;
  }
  var lists2 = document.getElementsByTagName("dl");
  for(var i = 0; i < lists2.length; i++){
    lists2[i].style.color =a;
  }

  var more_headers = document.getElementsByClassName("title");
  for(var i = 0; i < more_headers.length; i++){
    more_headers[i].style.color =a;
  }  
  var h5headers = document.getElementsByTagName("h5");
  for(var i = 0; i < h5headers.length; i++){
    h5headers[i].style.color =a;
  }  
  var chapter_num = document.getElementsByClassName("title-chapter");
  for(var i = 0; i < chapter_num.length; i++){
    chapter_num[i].style.color =a;
  }  

  var boxes = document.getElementsByClassName("note ui-has-child-title");
  for(var i = 0; i < boxes.length; i++){
    boxes[i].style.backgroundColor =c;
  }
  var sections = document.evaluate("//div[@class='note ui-has-child-title']/section", document, null, XPathResult.ANY_TYPE, null); 
  var theSection = sections.iterateNext();
  while (theSection){
    theSection.style.backgroundColor =c;  
    theSection = sections.iterateNext();
  }

  //var sections = document.getElementsByTagName("section");
  //for(var i = 0; i < sections.length; i++){
  //  sections[i].style.backgroundColor =c;
  //}  
  document.getElementById("content").style.backgroundColor =b;
}

function contrast_black_white() {
  contrast_change("white","black","#262626","#ededed");
}
function contrast_white_black() {
  contrast_change("black","white","#ededed","#262626");
}
function contrast_black_yellow() {
  contrast_change("yellow","black","#262626","#ffd123");
}
function contrast_yellow_black() {
  contrast_change("black","yellow","#ffd123","#262626");
}

function font_change() {
  var font = document.getElementById("text-style").value;
  var x = document.getElementsByClassName("main-page");
  x[0].style.fontFamily = font;
}

function line_spacing() {
  var spacing = document.getElementById("line-space").value;
  var x = document.getElementsByClassName("main-page");
  x[0].style.lineHeight = (spacing)*1.15;
  document.getElementById("spacing-value").innerHTML = spacing;
}

function reset() {
  contrast_change("#555555","white","#ededed","#21366b");
  var x = document.getElementsByClassName("main-page");  
  x[0].style.fontFamily = font;
  x[0].style.lineHeight = "1.42857143";
  document.getElementById("text-style").options[0].selected = 'selected';
  document.getElementById("line-space").value = "1.42857143";
  document.getElementById("spacing-value").innerHTML = "";
}

</script>

{{#if book}}
  <div class="media-nav{{#is status 'publishing'}} publishing{{/is}}">
    <div class="media-toolbar">
      {{#unless _hideProgress}}
        <button class="toggle contents btn" role="button">
          <span class="fa fa-th-list"></span>
           <span class="text">Contents</span>
           <span class="fa fa-plus open-indicator"></span>
        </button>
        <button class="toggle preferences btn" role="button" onclick="show()">
          <span class="text">Preferences</span>
          <span class="fa fa-plus open-indicator"></span>
        </button>
        
        <div class="searchbar">
          <span class="fa fa-search"></span>
          <input class="find form-control" type="search" placeholder="Search this book" value="{{searchTerm}}" />
        </div>
      {{/unless}}
      <div class="media-navbar">
        <div class="book-nav" aria-busy="true">
          {{#if back}}
            <a class="nav back" href="{{back}}" data-trigger="false">Back</a>
          {{else}}
            <div class="nav back disabled">Back</div>
          {{/if}}

          {{#unless _hideProgress}}
            <div class="progress">
              <div class="secondary progress-bar" style="width: {{percent page pages}}%;"></div>
            </div>
          {{else}}
            <div class="back-to-top">
              <a href="#">Back to Top</a>
            </div>
          {{/unless}}

          {{#if next}}
            <a class="nav next" href="{{next}}" data-trigger="false">Next</a>
          {{else}}
            <div class="nav next disabled">Next</div>
          {{/if}}
        </div>
        
      </div>
      <br>
	<div  id="preferences-options" value="" style="display:none;">

	<div class="preferences-box">
	<b>Contrast</b><br>
	<button id="black-white" class="contrast-option" onclick="contrast_black_white()">a</button>
	<button id="white-black" class="contrast-option" onclick="contrast_white_black()">a</button>	
 	<button id="black-yellow" class="contrast-option" onclick="contrast_black_yellow()">a</button>
	<button id="yellow-black" class="contrast-option" onclick="contrast_yellow_black()">a</button>
	</div>
        
	<div class="preferences-box"  >
	<div class="dropdown">
	  <b>Text Style</b><br>
	  <select id="text-style" onchange="font_change()" >
	    <option value="'Helvetica Neue'">Default</option>
 	    <option value="dyslexie">Dyslexie</option>
	    <option value="Times">Times New Roman</option>
	    <option value="Helvetica">Helvetica</option>
	  </select>
	</div>
        </div>

	<div class="preferences-box"  >
          <b>Keyword Hilighting</b><br>
	  <input type="checkbox" name="highlight" value="Highlight">  Highlight Keywords<br>
        </div>

	<div class="preferences-box"  >
	<div class="dropdown">
  	  <b>Line spacing</b><br><br>
	  <input type="range" id="line-space" name="line-space" onchange="line_spacing()" min="1" max="2" step=".1" value="1.242">        
          <center><span id="spacing-value"></span></center>
	</div>
	</div>
        
	
 	<button class="reset-button" onclick="reset()" valign="center">reset</button>

	</div>

    </div>
  </div>
{{/if}}

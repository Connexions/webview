<script>
var loaded = 0;
var user = "0";
function show() {

  var x = document.URL;
  if(loaded == 0 || (document.getElementById("user").value != "" && user != document.getElementById("user").value)){
    loadnotes();
    loaded = 1;
  }

  if(document.getElementById("notesbox").style.display == "none"){
    document.getElementById("notesbox").style.display ="";
    document.getElementById("saveme").style.display ="";    
  }
  else{
    document.getElementById("notesbox").style.display ="none";
    document.getElementById("saveme").style.display ="none";

   }
}

function save(){
  var x = document.URL;
  localStorage.setItem(String(x), document.getElementById("notesbox").value);
}

function revert(){

}

function loadnotes() {
  user = document.getElementById("user").value;
  var xhttp = new XMLHttpRequest();
  document.getElementById("notesbox").value = "";
  xhttp.onreadystatechange = function() {
    if (xhttp.readyState == 4 && xhttp.status == 200) {
      document.getElementById("notesbox").value = xhttp.responseText;
    }
  };
  if(parseInt(user) == 0){
    xhttp.open("GET", "https://s3-us-west-2.amazonaws.com/testnotesbucket/notes/"+document.title+".txt", true);}
  else{
    xhttp.open("GET", "https://s3-us-west-2.amazonaws.com/testnotesbucket/notes/"+user+"/"+document.title+".txt", true);
  }
  xhttp.send();
}

function savenotes() {
  user = document.getElementById("user").value;
  var xhttp = new XMLHttpRequest();
  if(parseInt(user) == 0){
    xhttp.open("PUT", "https://s3-us-west-2.amazonaws.com/testnotesbucket/notes/"+document.title+".txt", true);}
  else{
    xhttp.open("PUT", "https://s3-us-west-2.amazonaws.com/testnotesbucket/notes/"+user+"/"+document.title+".txt", true);
  }
  xhttp.send(document.getElementById("notesbox").value);
}


</script>

{{#if book}}
  <div class="media-nav{{#is status 'publishing'}} publishing{{/is}}">
    <div class="media-toolbar">
      {{#unless _hideProgress}}
        <button class="toggle contents btn" role="button">
          <span class="fa fa-th-list"></span>
           <span class="text">Contents</span>
           <span class="fa fa-plus open-indicator"></span>
        </button>
        <button class="toggle notes btn" role="button" onclick="show()">
          <span class="text">Notes</span>
          <span class="fa fa-plus open-indicator"></span>
        </button>
        
        <div class="searchbar">
          <span class="fa fa-search"></span>
          <input class="find form-control" type="search" placeholder="Search this book" value="{{searchTerm}}" />
        </div>
      {{/unless}}
      <div class="media-navbar">
        <div class="book-nav" aria-busy="true">
          {{#if back}}
            <a class="nav back" href="{{back}}" data-trigger="false">Back</a>
          {{else}}
            <div class="nav back disabled">Back</div>
          {{/if}}

          {{#unless _hideProgress}}
            <div class="progress">
              <div class="secondary progress-bar" style="width: {{percent page pages}}%;"></div>
            </div>
          {{else}}
            <div class="back-to-top">
              <a href="#">Back to Top</a>
            </div>
          {{/unless}}

          {{#if next}}
            <a class="nav next" href="{{next}}" data-trigger="false">Next</a>
          {{else}}
            <div class="nav next disabled">Next</div>
          {{/if}}
        </div>
        
      </div><br><textarea id="notesbox" rows="4" cols="50" 
      value="" style="display:none;"></textarea>
        <br>
        <button class="save" role="button" id="saveme" onclick="savenotes()" style="display:none;">
           <span class="text">Save Notes</span>
        </button>
        <input type="number" id="user" placeholder="User #" maxlength="4" style="display:none;" value="0">
    </div>
  </div>
{{/if}}

define(["./normalize"],function(t){function e(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1}if("undefined"==typeof window)return{load:function(t,e,n){n()}};var n=!1,i=document.getElementsByTagName("head")[0],s=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),o=!1;s&&(s[1]||s[7]?(o=parseInt(s[1])<6||parseInt(s[7])<=9,s="trident"):s[2]?(o=!0,s="webkit"):s[3]||(s[4]?(o=parseInt(s[4])<18,s="gecko"):n&&alert("Engine detection failed")));var r={},a=/^\/|([^\:\/]*:)/;r.pluginBuilder="./css-builder";var c=[],h={},l=[];r.addBuffer=function(t){-1==e(c,t)&&-1==e(l,t)&&(c.push(t),l.push(t))},r.setBuffer=function(e,n){var i=window.location.pathname.split("/");i.pop(),i=i.join("/")+"/";var s=require.toUrl("base_url").split("/");s.pop();var o=s.join("/")+"/";o=t.convertURIBase(o,i,"/"),o.match(a)||(o="/"+o),"/"!=o.substr(o.length-1,1)&&(o+="/"),r.inject(t(e,o,i));for(var l=0;l<c.length;l++)(n&&".less"==c[l].substr(c[l].length-5,5)||!n&&".css"==c[l].substr(c[l].length-4,4))&&(function(t){h[t]=h[t]||!0,setTimeout(function(){"function"==typeof h[t]&&h[t](),delete h[t]},7)}(c[l]),c.splice(l--,1))},r.attachBuffer=function(t,n){for(var i=0;i<c.length;i++)if(c[i]==t)return h[t]=n,!0;return h[t]===!0?(h[t]=n,!0):-1!=e(l,t)?(n(),!0):void 0};var u=function(t,e){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var i=document.styleSheets[n];if(i.href==t.href)return e()}u(t,e)},10)},p=function(t,e){setTimeout(function(){try{return t.sheet.cssRules,e()}catch(n){}p(t,e)},10)};if("trident"==s&&o)var d=[],f=[],m=0,v=function(t,e){var n;f.push({url:t,cb:e}),n=d.shift(),!n&&m++<12&&(n=document.createElement("style"),i.appendChild(n)),g(n)},g=function(t){var e=f.shift();if(!e)return t.onload=y,d.push(t),void 0;t.onload=function(){e.cb(e.ss),g(t)};var n=t.styleSheet;e.ss=n.imports[n.addImport(e.url)]};var b=function(t){var e=document.createElement("link");return e.type="text/css",e.rel="stylesheet",e.href=t,e},y=function(){};r.linkLoad=function(t,e){var r=setTimeout(function(){n&&alert("timeout"),e()},1e3*S-100),a=function(){clearTimeout(r),c&&(c.onload=y),setTimeout(e,7)};if(o)if("webkit"==s){var c=b(t);u(c,a),i.appendChild(c)}else if("gecko"==s){var h=document.createElement("style");h.textContent='@import "'+t+'"',p(h,a),i.appendChild(h)}else"trident"==s&&v(t,a);else{var c=b(t);c.onload=a,i.appendChild(c)}};var k,w=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],T={},C=function(t,e,n){if(T[t])return e(T[t]),void 0;var i,s,o;if("undefined"!=typeof XMLHttpRequest)i=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(s=0;3>s;s+=1){o=w[s];try{i=new ActiveXObject(o)}catch(r){}if(i){w=[o];break}}i.open("GET",t,requirejs.inlineRequire?!1:!0),i.onreadystatechange=function(){var s,o;4===i.readyState&&(s=i.status,s>399&&600>s?(o=new Error(t+" HTTP status: "+s),o.xhr=i,n(o)):(T[t]=i.responseText,e(i.responseText)))},i.send(null)},x=0;r.inject=function(t){31>x&&(k=document.createElement("style"),k.type="text/css",i.appendChild(k),x++),k.styleSheet?k.styleSheet.cssText+=t:k.appendChild(document.createTextNode(t))};var L=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,F=window.location.pathname.split("/");F.pop(),F=F.join("/")+"/";var E=function(e,n,i){e.match(a)||(e="/"+t.convertURIBase(e,F,"/")),C(e,function(s){s=t(s,e,F);for(var o,r=[],a=[],c=[];o=L.exec(s);){var h=o[4]||o[5]||o[7]||o[8]||o[9];r.push(h),a.push(L.lastIndex-o[0].length),c.push(o[0].length)}for(var l=0,u=0;u<r.length;u++)!function(t){E(r[t],function(e){s=s.substr(0,a[t])+e+s.substr(a[t]+c[t]);for(var i=e.length-c[t],o=t+1;o<r.length;o++)a[o]+=i;l++,l==r.length&&n(s)},i)}(u);0==r.length&&n(s)},i)};r.normalize=function(t,e){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),e(t)};var S,D=!1;return r.load=function(t,e,i,s,a){S=S||s.waitSeconds||7;var c=t+(a?".less":".css");r.attachBuffer(c,i)||(fileUrl=e.toUrl(c),!D&&n&&(alert(o?"hacking links":"not hacking"),D=!0),a?E(fileUrl,function(t){a&&(t=a(t,function(t){r.inject(t),setTimeout(i,7)}))}):r.linkLoad(fileUrl,i))},n&&(r.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0}),r});